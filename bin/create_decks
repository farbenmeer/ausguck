#!/usr/bin/env bash

set -e

readonly DECKS=$(find ./decks -type f -name '*.mdx')
readonly DECK_NAMES=$(find ./decks -type f -name '*.mdx' | sed 's/\.\/.*\/\(.*\)\.mdx$/\1/g' | sort)

function checkout_decks() {
    git checkout -- $DECKS
}

function create_decks() {
    for deck in $DECK_NAMES; do
        if [[ "$deck" == "sample" ]]; then
            continue
        fi

        rm -Rf public
        yarn build "$deck"
        mkdir -p ausguck/"$deck"
        mv public/* ausguck/"$deck"/
    done
    rm -Rf public
}

function copy_images () {
    cp -r decks/images ausguck/images
}

function copy_examples() {
    cp -r examples ausguck
}

function create_index() {
    {
        echo "# All decks from farbenmeer"
        for deck in $DECK_NAMES; do
        if [[ "$deck" == "sample" ]]; then
            continue
        fi
        printf "* [%s](%s)\n" "$deck" "$deck"
        done

        printf "\n\n[farbenmeer.de](https://www.farbenmeer.de)"

    } >> ausguck/index.md
}

rm -Rf docs
create_decks
checkout_decks
create_index
copy_images
copy_examples
