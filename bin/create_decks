#!/usr/bin/env bash

set -e

readonly DECKS=$(find ./decks/ -type f -name '*.mdx' | sed 's/\.\/.*\/\(.*\)\.mdx$/\1/g' | sort)


function create_decks() {
    for deck in $DECKS; do
        if [[ "$deck" == "sample" ]]; then
            continue
        fi

        rm -Rf dist
        yarn build "$deck"
        mkdir -p ausguck/"$deck"
        mv dist/* ausguck/"$deck"/
    done
    rm -Rf dist
}

function copy_images () {
    cp -r decks/images ausguck
}

function copy_examples() {
    cp -r examples ausguck
}

function create_index() {
    {
        echo "# All decks from farbenmeer"
        for deck in $DECKS; do
        if [[ "$deck" == "sample" ]]; then
            continue
        fi
        printf "* [%s](%s)\n" "$deck" "$deck"
        done

        printf "\n\n[farbenmeer.de](https://www.farbenmeer.de)"

    } >> ausguck/index.md
}

rm -Rf docs
create_decks
create_index
copy_images
copy_examples
