#!/usr/bin/env bash

set -e

readonly DECKS=$(find . -type f -name '*.mdx' | sed 's/\.\/.*\/\(.*\)\.mdx$/\1/g' | sort)


function create_decks() {
    for deck in $DECKS; do
        if [[ "$deck" == "sample" ]]; then
            continue
        fi

        rm -Rf dist
        yarn build "$deck"
        mkdir -p build/"$deck"
        mv dist/* build/"$deck"/
    done
    rm -Rf dist
}

function copy_images () {
    cp -r decks/images build
}

function create_index() {
    {
        echo "<h1> All decks from farbenmeer</h1>"
        for deck in $DECKS; do
        if [[ "$deck" == "sample" ]]; then
            continue
        fi
        echo '<a href="'"$deck"'">'"$deck"'</a></br>'
        done

        echo "<p>www.farbenmeer.de</p>"

    } >> build/index.html
}

rm -Rf docs
create_decks
create_index
copy_images
