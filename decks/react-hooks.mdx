import { Head } from 'mdx-deck'
import { Image } from 'mdx-deck'
export { default as theme } from '../theme'

<Head>
  <title>react-hooks and how we got there</title>
</Head>

# react-hooks
## and how we got there

by Henrik Wenz

---

## Agenda

* The Problem
* History of patterns
* React Hooks

---

# How do I share the code between several components?

---

## #1 Mixins

```js
const WindowSizeMixin = {
  getInitialState() {
    return {
      width: 0,
      height: 0
    }
  }

  onResize: (event) => {
    this.setState({
      width: window.innerWidth,
      height: window.innerHeight
    })
  },

  componentDidMount () {
    window.addEventListener('resize', this.onResize)
  }

  componentWillUnmount() {
    window.removeEventListener('resize', this.onResize)
  }
}
```

---

## #1 Mixins

```js
export default React.createClass({
  mixins: [WindowSizeMixin],
  render () {
    return (
      <div>
        Width: {this.state.width} <br />
        Height: {this.state.height}
      </div>
    )
  }
})
```

---

## #2 Higher Order Components (hocs)

```js
const useWindowSize = (Component) => {
  return class UseWindowSize extends React.Component {
    getInitialState() {
      return {
        width: 0,
        height: 0
      }
    }

    onResize: (event) => {
      this.setState({
        width: window.innerWidth,
        height: window.innerHeight
      })
    },

    componentDidMount () {
      window.addEventListener('resize', this.onResize)
    }

    componentWillUnmount() {
      window.removeEventListener('resize', this.onResize)
    }

    render () {
      return this.props.children
    }
  }
}
```

---

## #2 Higher Order Components (hocs)

```js
export default useWindowSize(({ width, height }) => (
  <div>
    Width: {width} <br />
    Height: {height}
  </div>
))
```

---

## #3 Render Functions / Props

```js
class WindowSize extends React.Component {
    getInitialState() {
      return {
        width: 0,
        height: 0
      }
    }

    onResize: (event) => {
      this.setState({
        width: window.innerWidth,
        height: window.innerHeight
      })
    },

    componentDidMount () {
      window.addEventListener('resize', this.onResize)
    }

    componentWillUnmount() {
      window.removeEventListener('resize', this.onResize)
    }

    render () {
      return this.props.children(this.state)
    }
  }
```

---

## #3 Render Functions / Props

```js
export default ({ width, height }) => (
  <WindowSize>{({ width, height }) => (
    <div>
      Width: {width} <br />
      Height: {height}
    </div>
  )}</WindowSize>
)
```

---

# any more?

---

<Image src='https://user-images.githubusercontent.com/91933/51640156-98379880-1f17-11e9-86bf-79ba3bc5ccf1.png' />

---

# Hooks are an feature that lets you use state and other React features without writing a class

---

## History

* Jordan Walke already talked about hooks in 2013
* Dan Abromov introduces them React Conf 2018
* Today hooks got merged into master!

---

## State Hook

```js
import { useState } from 'react';

function Example() {
  // Declare a new state variable, which we'll call "count"
  const [count, setCount] = useState(0);
  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
```

---

## State Hook (multibe variables)

```js
function ExampleWithManyStates() {
  // Declare multiple state variables!
  const [age, setAge] = useState(42);
  const [fruit, setFruit] = useState('banana');
  const [todos, setTodos] = useState([{ text: 'Learn Hooks' }]);
  // ...
}
```

---

## Effect Hook

* Perform side effects from a function component (`componentDidMount`, `componentDidUpdate`, `componentWillUnmount`).
* Runs after flushing changes to the DOM.

```js
import { useState, useEffect } from 'react';

function Example() {
  const [count, setCount] = useState(0);

  // Similar to componentDidMount and componentDidUpdate:
  useEffect(() => {
    // Update the document title using the browser API
    document.title = `You clicked ${count} times`;
  });

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  );
}
```

---

## Effect Hook (cleanup)

```js
import { useState, useEffect } from 'react';

function FriendStatus(props) {
  const [isOnline, setIsOnline] = useState(null);

  function handleStatusChange(status) {
    setIsOnline(status.isOnline);
  }

  useEffect(() => {
    ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);

    return () => {
      ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);
    };
  });

  if (isOnline === null) {
    return 'Loading...';
  }
  return isOnline ? 'Online' : 'Offline';
}
```

---

## Rules of Hooks

Hooks are JavaScript functions, but they impose two additional rules:

1. Only call Hooks at the top level. Don’t call Hooks inside loops, conditions, or nested functions.
2. Only call Hooks from React function components. Don’t call Hooks from regular JavaScript functions.

---

## #4 React Hooks

```js
function useWindowSize() {
  const [width, setWidth] = React.useState(0)
  const [height, setHeight] = React.useState(0)

  useEffect(() => {
    const handleResize = () => {
      setWidth(window.innerWidth)
      setHeight(window.innerHeight)
    }
    window.addEventListener('resize', handleResize)
    return () => window.removeEventListener('resize', handleResize)
  }, [])

  return {
    width,
    height
  }
}
```

---

## #4 React Hooks

```js
export default () => {
  const { width, height } = useWindowSize()
  return (
    <div>
      Width: {width} <br />
      Height: {height}
    </div>
  )
}
```

---

## Hooks Overview

* Basic Hooks
  * useState
  * useEffect
  * useContext

* Additional Hooks
  * useReducer
  * useCallback
  * useMemo
  * useRef
  * useImperativeHandle
  * useLayoutEffect
  * useDebugValue

---

## Reducer Hook - Redux is dead?

```js
const initialState = {count: 0};

function reducer(state, action) {
  switch (action.type) {
    case 'reset':
      return initialState;
    case 'increment':
      return {count: state.count + 1};
    case 'decrement':
      return {count: state.count - 1};
    default:
      // A reducer must always return a valid state.
      // Alternatively you can throw an error if an invalid action is dispatched.
      return state;
  }
}

function Counter({initialCount}) {
  const [state, dispatch] = useReducer(reducer, {count: initialCount});
  return (
    <>
      Count: {state.count}
      <button onClick={() => dispatch({type: 'reset'})}>
        Reset
      </button>
      <button onClick={() => dispatch({type: 'increment'})}>+</button>
      <button onClick={() => dispatch({type: 'decrement'})}>-</button>
    </>
  );
}
```

---

## Use Context - React-Router

```js
import { useContext } from 'react'
import { __RouterContext as RouterContext, matchPath } from 'react-router-dom'

export default function useRouter (options = {}) {
  const context = useContext(RouterContext)
  const location = options.location || context.location
  const match = options.path
    ? matchPath(location.pathname, options)
    : context.match

  return { ...context, location, match }
}
```

---

https://reactjs.org/blog/2019/02/06/react-v16.8.0.html

---

# Thanks!
