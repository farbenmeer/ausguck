import { Head } from 'mdx-deck'

export { default as theme } from '../theme'

<Head>
  <title>useEffect hook</title>
  <meta name="author" content="Moritz Thomas" />
</Head>

# useEffect hook
by Moritz Thomas

---

## Simple example
```js
  const [count, setCount] = useState(0);

  // Similar to componentDidMount and componentDidUpdate:
  useEffect(() => {
    // Update the document title using the browser API
    document.title = `You clicked ${count} times`;
  });
```

---

## Which should be more like this
```js
  const [count, setCount] = useState(0);

  useEffect(() => {
    document.title = `You clicked ${count} times`;
  }, [count]);
```

---

## Example with deps
```js
useEffect(() => trackPageView(location), [location]);
```

---

## https://www.npmjs.com/package/eslint-plugin-react-hooks
```js
{
  "plugins": [
    // ...
    "react-hooks"
  ],
  "rules": {
    // ...
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn"
  }
}
```

---

## Cleanup
```js
useEffect(() => {
    // ...
    return () => {
        // clean something up like
        // timers or subscriptions
    };
});
```

---

## componentDidMount Pattern
```js
useEffect(() => {
  // ...
}, []);
```

---

## Example
```js
useEffect(() => {
  setSnackbar(JSCookie.get(COOKIE_CONSENT_NAME) !== 'yes');
}, []);
```

---

## componentWillUnmount Pattern
```js
useEffect(() => {
  // ...
  return () => {
    // do unmount stuff
  };
}, []);
```

---

## componentWillUnmount in short:
```js
useEffect(() => () => {
  /* do unmount stuff */
});
```

---

## Example
```js
const VideoPlaceholder = ({ url }) => {
  const [play, setPlay] = useState(false);
  // Disable video when switching to different recipe!
  useEffect(() => () => setPlay(false), [url]);
```

---

# Big real-life example:

---

```js
const jumpMarker = useRef(null);

useEffect(() => {
  let timeout;
  if (typeof window !== 'undefined' && hash && window.location.hash === hash) {
    // Apparently scrolling has to be delayed slightly for unclear reasons.
    timeout = setTimeout(() => {
      jumpMarker.current.scrollIntoView();
    }, 500);
  }
  return () => clearTimeout(timeout); // Cleanup
}, [hash, jumpMarker]);
```

---

## Sources
- [https://overreacted.io/a-complete-guide-to-useeffect/](https://overreacted.io/a-complete-guide-to-useeffect/)
- [https://reactjs.org/docs/hooks-effect.html](https://reactjs.org/docs/hooks-effect.html)
## Further reading
- Data fetching with hooks: https://www.robinwieruch.de/react-hooks-fetch-data/